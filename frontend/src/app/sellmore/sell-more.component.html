<div class="sellMore">
	<header>
		<div class="logo">
			<img src="/assets/img/system/sellmore.webp" width="55px" />
			<!-- <img src="/assets/img/logo/logo.svg" alt="" srcset="" width="56px" /> -->
		</div>
		<div class="search">
			<div class="input" style="width: 490px !important">
				<div class="inputIcon">
					<i class="fa fa-search"></i>
				</div>
				<div class="inputText">
					<input type="text" class="w-100" placeholder="Buscar" />
				</div>
			</div>
		</div>
		<button class="btn-secondary" style="margin-top: 0!important; padding: 10px 32px!important;" data-toggle="modal"
			data-target="#modalDonate">
			Doar
		</button>

		<div class="profile">
			<img class="cursor-pointer" src="/assets/img/user/user.png" alt="" width="55px"
				[matMenuTriggerFor]="profile">
		</div>

		<mat-menu #profile="matMenu">
			<button mat-menu-item>
				<i class="fas fa-id-card-alt"></i>
				{{user?.nome}}
			</button>
			<button mat-menu-item (click)="logout()">
				<i class="fas fa-sign-out-alt"></i> Sair
			</button>
		</mat-menu>

	</header>
	<div class="content pad40">
		<div class="row flex-direction-column">

			<div class="totalLead">{{statistics?.a}} referidos à contactar</div>
			<div class="totalOthers">{{statistics?.c}} {{statistics?.c <= 1 ?   'venda': 'vendas'}}</div>
			<div class="totalOthers">{{statistics?.pc}}
				{{statistics?.pc <= 1 ? 'problema com cartão' : 'problemas com cartão'}} </div>
			<div class="totalOthers">{{statistics?.ld}} ligar depois</div>
		</div>

		<div class="row flex-wrap">
			<div class="customers" *ngFor="let itemLead of customers | keyvalue; let even = even">
				<div class="parent center-center">
					<div class="contact">
						<div class="name">{{ itemLead?.value.name }}</div>
						<div class="phone">
							{{ itemLead?.value.phone | mask: "(00)00000-0000" }}
						</div>
					</div>
					<div class="action">
						<ng-container *ngIf="itemLead?.value.status != 'a'; else waiting">
							<div class="finished">
								<i *ngIf="itemLead.value.status == 'pc'"
									class="fa fa-credit-card icon-finished icon-finished-no">
								</i>
								<i *ngIf="itemLead.value.status == 'ld'" class="fa fa-headset icon-finished">
								</i>
								<i *ngIf="itemLead.value.status == 'n'"
									class="fa fa-thumbs-down icon-finished icon-finished-no">
								</i>
								<i *ngIf="itemLead.value.status == 'c'"
									class="fa fa-thumbs-up icon-finished icon-finished-yes">
								</i>
								<i class="fa fa-bars icon-finished cursor-pointer" matTooltip="Menu"
									[matMenuTriggerFor]="menu"></i>
								<mat-menu #menu="matMenu">
									<button mat-menu-item (click)="newChildren(itemLead?.value)" data-toggle="modal"
										data-target="#modalImportContact">
										<i class="fab fa-whatsapp"></i> Importar contatos
									</button>
									<button mat-menu-item>
										<a target="_BLANK" href="https://wa.me/55{{itemLead?.value.phone}}">
											<i class="fab fa-whatsapp"></i>
											Abrir no Whatsapp
										</a>
									</button>
									<button mat-menu-item (click)="updateOpenForm(itemLead.value)" data-toggle="modal"
										data-target="#modalStickyAdd">
										<i class="fas fa-edit"></i> Alterar
									</button>
									<button mat-menu-item (click)="inativar(itemLead.value)">
										<i class="fas fa-eye-slash"></i> Arquivar
									</button>

								</mat-menu>
							</div>
						</ng-container>
						<ng-template #waiting>
							<div class="waiting">
								<i (click)="changeStatus(itemLead.value, 'pc')" class="fa fa-credit-card icon-waiting"
									matTooltip="Problemas com cartão de crédito">
								</i>
								<i (click)="changeStatus(itemLead.value, 'ld')" class="fa fa-headset icon-waiting"
									matTooltip="Ligar depois"></i>
								<i (click)="changeStatus(itemLead.value, 'n')" class="fa fa-thumbs-down icon-waiting"
									matTooltip="Não deu negócio 😭"></i>
								<i (click)="changeStatus(itemLead.value, 'c')" class="fa fa-thumbs-up icon-waiting"
									matTooltip="Vendido 😃"></i>
								<i class="fa fa-bars icon-waiting cursor-pointer" matTooltip="Menu"
									[matMenuTriggerFor]="menu"></i>
								<mat-menu #menu="matMenu">
									<button mat-menu-item (click)="newChildren(itemLead.value)" data-toggle="modal"
										data-target="#modalImportContact">
										<i class="fab fa-whatsapp"></i> Importar contatos
									</button>
									<button mat-menu-item>
										<a target="_BLANK" href="https://wa.me/55{{itemLead?.value.phone}}">
											<i class="fab fa-whatsapp"></i>
											Abrir no Whatsapp
										</a>
									</button>
									<button mat-menu-item (click)="updateOpenForm(itemLead.value)" data-toggle="modal"
										data-target="#modalStickyAdd">
										<i class="fas fa-edit"></i> Alterar
									</button>
									<button mat-menu-item (click)="inativar(itemLead.value)">
										<i class="fas fa-eye-slash"></i> Arquivar
									</button>
								</mat-menu>
							</div>
						</ng-template>
					</div>
				</div>
				<perfect-scrollbar>
					<div class="children">
						<div class="item" *ngFor="
								let item of itemLead.value.referidos | keyvalue
							">
							<div class="contacto cursor-pointer" (click)="callTo(item.value)" data-toggle="modal"
								data-target="#modalCall">
								<span>
									<div class="contacto-name">
										{{ item.value.name }}
									</div>
									<div class="contacto-phone">
										{{
											item.value.phone
												| mask: "(00)00000-0000"
										}}
									</div>
								</span>
							</div>

							<ng-container *ngIf="
									item.value.status != 'a';
									else waitingChildren
								">
								<div class="finished">
									<i *ngIf="item.value.status == 'pc'"
										class="fa fa-credit-card icon-finished icon-finished-no">
									</i>
									<i *ngIf="item.value.status == 'ld'"
										class="fa fa-headset icon-finished icon-finished-no">
									</i>
									<i *ngIf="item.value.status == 'n'"
										class="fa fa-thumbs-down icon-finished icon-finished-no">
									</i>
									<i *ngIf="item.value.status == 'c'"
										class="fa fa-thumbs-up icon-finished icon-finished-yes">
									</i>
									<i class="fa fa-bars icon-finished" style="margin-left: 15px" matTooltip="Menu"
										[matMenuTriggerFor]="menu"></i>
									<mat-menu #menu="matMenu">
										<button mat-menu-item (click)="newChildren(item?.value)" data-toggle="modal"
											data-target="#modalImportContact">
											<i class="fab fa-whatsapp"></i> Importar contatos
										</button>
										<button mat-menu-item>
											<a target="_BLANK" href="https://wa.me/55{{item?.value.phone}}">
												<i class="fab fa-whatsapp"></i>
												Abrir no Whatsapp
											</a>
										</button>
										<button mat-menu-item (click)="updateOpenForm(item.value)" data-toggle="modal"
											data-target="#modalStickyAdd">
											<i class="fas fa-edit"></i> Alterar
										</button>
										<button mat-menu-item (click)="inativar(item.value)">
											<i class="fas fa-eye-slash"></i> Arquivar
										</button>
										<button mat-menu-item (click)="newChildren(item.value)" data-toggle="modal"
											data-target="#modalStickyAdd">
											<i class="fa fa-chalkboard-teacher"></i>
											Tornar Lead
										</button>
									</mat-menu>
								</div>
							</ng-container>
							<ng-template #waitingChildren>
								<div class="waiting">
									<i (click)="changeStatus(item.value, 'pc')" class="fa fa-credit-card icon-waiting"
										matTooltip="Problemas com cartão de crédito">
									</i>
									<i (click)="changeStatus(item.value, 'ld')" class="fa fa-headset icon-waiting"
										matTooltip="Ligar depois"></i>
									<i (click)="changeStatus(item.value, 'n')" class="fa fa-thumbs-down icon-waiting"
										matTooltip="Não deu negócio 😭"></i>
									<i (click)="changeStatus(item.value, 'c')" class="fa fa-thumbs-up icon-waiting"
										matTooltip="Vendido 😃"></i>
									<i class="fa fa-bars icon-waiting" matTooltip="Menu" [matMenuTriggerFor]="menu"></i>
									<mat-menu #menu="matMenu">
										<button mat-menu-item (click)="newChildren(item?.value)" data-toggle="modal"
											data-target="#modalImportContact">
											<i class="fab fa-whatsapp"></i> Importar contatos
										</button>
										<button mat-menu-item>
											<a target="_BLANK" href="https://wa.me/55{{item?.value.phone}}">
												<i class="fab fa-whatsapp"></i>
												Abrir no Whatsapp
											</a>
										</button>
										<button mat-menu-item (click)="updateOpenForm(item.value)" data-toggle="modal"
											data-target="#modalStickyAdd">
											<i class="fas fa-edit"></i> Alterar
										</button>
										<button mat-menu-item (click)="inativar(item.value)">
											<i class="fas fa-eye-slash"></i> Arquivar
										</button>
										<button mat-menu-item (click)="newChildren(item.value)" data-toggle="modal"
											data-target="#modalStickyAdd">
											<i class="fa fa-chalkboard-teacher"></i>
											Tornar Lead
										</button>
									</mat-menu>
								</div>
							</ng-template>
						</div>
					</div>
				</perfect-scrollbar>

				<div class="info center-center">
					<div class="quantitative">
						{{ itemLead.value.referidos.length | json }} referidos
						<br />
						N à contactar
					</div>
					<div class="action">
						<div class="actionButton" (click)="newChildren(itemLead.value)" data-toggle="modal"
							data-target="#modalStickyAdd">
							<i class="fa fa-plus"></i>
						</div>

					</div>
				</div>
			</div>
		</div>
	</div>
	<footer>
		<div class="footerItens" (click)="newLead()" data-toggle="modal" data-target="#modalScriptAdd">
			<i class="fa fa-receipt"></i>
		</div>
		<div class="footerItens" (click)="newLead()" data-toggle="modal" data-target="#modalStickyAdd">
			<i class="fa fa-plus"></i>
		</div>
	</footer>
</div>

<!-- Modal cadastre indicados -->
<div class="modal fade" id="modalStickyAdd" tabindex="-1" aria-labelledby="modalNewSticky" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h3 class="modal-title" id="modalNewSticky">
					<ng-container *ngIf="parent.id; else indicatedBy">
						<p>
							Cadastre abaixo os indicados do(a) {{ parent.name }}
						</p>
					</ng-container>
					<ng-template #indicatedBy>
						<span *ngIf="!form.value.id">Novo referido </span>
						<span *ngIf="form.value.id">Alterando referido </span>
					</ng-template>
				</h3>
			</div>
			<div class="modal-body">
				<div class="content">
					<form [formGroup]="form" novalidate>
						<div class="input">
							<div class="inputIcon">
								<i class="fa fa-user"></i>
							</div>
							<div class="inputText">
								<input type="text" class="w-100" formControlName="name" placeholder="Nome" />
							</div>
						</div>
						<div class="input">
							<div class="inputIcon">
								<i class="fa fa-mobile-alt"></i>
							</div>
							<div class="inputText">
								<input type="text" class="w-100" formControlName="phone" placeholder="Telefone"
									mask="(00)00000-0000" />
							</div>
						</div>
						<textarea placeholder="Observação" class="textarea" formControlName="observation">
						</textarea>
						<div class="input">
							<div class="inputIcon">
								<i class="fa fa-info"></i>
							</div>
							<div class="inputText">
								<select formControlName="status" class="w-100">
									<option value="" selected>
										Selecione uma opção caso tenha entrado
										em contato com o referente
									</option>
									<option *ngFor="let item of status" [value]="item.id">
										{{ item?.status }}
									</option>
								</select>
							</div>
						</div>
					</form>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal" #closemodalStickyAdd>
					Fechar
				</button>


				<ng-container *ngIf="!form.value.id; else elseTemplateUpdate">
					<button type="button" class="btn btn-primary" (click)="save(form.value)" [disabled]="!form.valid">
						Salvar
					</button>
				</ng-container>
				<ng-template #elseTemplateUpdate>
					<button type="button" class="btn btn-primary" (click)="update(form.value)" [disabled]="!form.valid">
						Alterar
					</button>
				</ng-template>
			</div>
		</div>
	</div>
</div>

<!-- Modal roteiro -->
<div class="modal fade" id="modalScriptAdd" tabindex="-1" aria-labelledby="modalNewScript" aria-hidden="true">
	<div class="modal-dialog modal-exlg">
		<div class="modal-content">
			<div class="modal-header">
				<h3 class="modal-title" id="modalNewScript">
					<p>Roteiro</p>
				</h3>
			</div>
			<div class="modal-body">
				<div class="content">
					<form [formGroup]="formScript" novalidate>
						<textarea placeholder="Estratégia" class="textarea" formControlName="strategy">
						</textarea>
					</form>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal" #closemodalScriptAdd>
					Fechar
				</button>
				<button type="button" class="btn btn-primary" (click)="saveStrategy(formScript.value)"
					[disabled]="!formScript.valid">
					Salvar
				</button>
			</div>
		</div>
	</div>
</div>

<!-- Modal importando contatos -->
<div class="modal fade" id="modalImportContact" tabindex="-1" aria-labelledby="modalNewImportContact"
	aria-hidden="true">
	<div class="modal-dialog ">
		<div class="modal-content">
			<div class="modal-header">
				<h3 class="modal-title" id="modalNewImportContact">
					<p>Importanto contatos indicados do(a) {{ parent.name }} </p>
				</h3>
			</div>
			<div class="modal-body">
				<div class="content">
					<span *ngIf="customersImported.length == 0">
						<h2>Anexe o arquivo baixado na conversa com o(a) {{ parent.name }} </h2>
						<div class="form-group margint-25">
							<input style="display: none" type="file" (change)="onFileChanged($event)" #fileInput />
							<div class="uploadArquivo"
								[style.background-image]=" 'url(' + img + ' )' | safeHtml: 'style' "></div>
							<button class="btn btn-upload btn-secondary" (click)="fileInput.click()"> Anexar arquivo
							</button>
						</div>
					</span>
					<ng-container *ngIf="customersImported.length != 0">
						<div class="card"
							style="background: transparent; color: var(--backgroundColor); margin-bottom: 15px;">
							<h3>Importado {{customersImported?.res.length}}</h3>
							<div *ngFor="let item of customersImported?.res" style="margin-top: 15px;">
								{{ item?.name }} <br>
								{{ item?.phone}}
							</div>

						</div>
						<div class="card" style="background: transparent; color: var(--backgroundColor)">
							<h3>Indicado por outro lead {{customersImported?.repetidos.length}}</h3>
							<p *ngFor="let item of customersImported?.repetidos">
								{{item}}
							</p>

						</div>

					</ng-container>

				</div>
			</div>
			<div class="modal-footer" *ngIf="customersImported.length == 0">
				<button type="button" class="btn btn-primary" (click)="importContact(formScript.value)">
					Importar
				</button>
			</div>
		</div>
	</div>
</div>

<!-- Modal calling -->

<div class="modal fade" id="modalCall" tabindex="-1" aria-labelledby="modalStapcall" aria-hidden="true">
	<div class="modal-dialog modal-exlg">
		<div class="modal-content">
			<div class="modal-header">
				<h2 class="modal-title" id="modalStapcall">
					<p>Ligando para {{ person.name }}</p>
				</h2>
			</div>
			<div class="modal-body">
				<!-- <p>Observação: {{ person.observation }}</p>
				<br /> -->

				<div class="content rowCall">
					<div class="person">
						<form [formGroup]="form" novalidate>
							<textarea (change)="update(form.value,false,true)" placeholder="Observação" class="textarea"
								formControlName="observation" style="width: 95%; height: 300px;">
							</textarea>
						</form>
						<b>Árvores de indicações</b>
						<div class="tree margint-25" *ngFor="let itemParent of parents; let i = index">
							<div [style.marginLeft.px]="20 * i">
								<div class="parentName">
									<i class="fa fa-folder-open"></i>

									{{ itemParent.name }}
									<span *ngIf="itemParent.status != 'a'">
										<i *ngIf="itemParent.status == 'pc'"
											class="fa fa-credit-card icon-finished icon-finished-no">
										</i>
										<i *ngIf="itemParent.status == 'ld'" class="fa fa-headset icon-finished">
										</i>
										<i *ngIf="itemParent.status == 'n'"
											class="fa fa-thumbs-down icon-finished icon-finished-no">
										</i>
										<i *ngIf="itemParent.status == 'c'"
											class="fa fa-thumbs-up icon-finished icon-finished-yes">
										</i>
									</span>
								</div>
								<div class="parentPhone">
									{{
										itemParent.phone
											| mask: "(00)00000-0000"
									}}
								</div>
								<div class="parentDesc">
									{{ itemParent.observation }}
								</div>
							</div>
						</div>
					</div>
					<div class="strategy">
						<perfect-scrollbar>
							<h1>Strategy</h1>
							<span *ngFor="let item of strategy?.staps">
								<!-- <span *ngIf="item.length"> -->
								{{ item }}
								<br />
								<!-- </span> -->
							</span>
						</perfect-scrollbar>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Modal doação -->
<div class="modal fade" id="modalDonate" tabindex="-1" aria-labelledby="modalNewDonate" aria-hidden="true">
	<div class="modal-dialog ">
		<div class="modal-content">
			<div class="modal-body">
				<div class="content">
					<p class="mb-15">
						O Sellmore é uma ferramenta sem fins lucrativos. Contudo, temos um grande gasto com servidores, pois
						não é nada fácil manter um programa com o porte do Sellmore no ar. <br>
					</p>
					<p class="mb-15">
						Colaborando conosco, você vai garantir nossa permanência no ar. <br>
					</p>
					<p class="mb-15">
						Faça sua parte. Ajude-nos a manter o servidor sempre on-line.
					</p>
					<div class="row center-center">
						<img style="text-align: center;" src="/assets/img/system/donate.png" alt="">
					</div>
					<button class="w-100">
						<a href="https://www.paypal.com/donate?hosted_button_id=JPB4P9HQXT3KS" target="_BLANK" style="color:#fff !important">
							Faça uma doação de qualquer valor.
						</a>
					</button>
				</div>
			</div>
		</div>
	</div>
</div>
